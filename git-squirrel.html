<head>
<style>
    body        { background: #fff; margin-left:  40px;   font-size:  0.9em;  font-family: sans-serif; max-width: 800px; }
    h1          { background: #ffb; margin-left: -30px;   border-top:    5px  solid #ccc; }
    h2          { background: #ffb; margin-left: -20px;   border-top:    3px  solid #ddd; }
    h3          { background: #ffb; margin-left: -10px; }
    h4          { background: #ffb; }
    code        { font-size:    1.1em;  background:  #ddf; }
    pre         { margin-left:  2em;    background:  #ddf; }
    pre code    { font-size:    1.1em;  background:  #ddf; }
</style>

</head>

<p style="text-align:center">
    <a href="master-toc.html">master TOC</a>
|
    <a href="master-toc.html#doc/git-squirrel">chapter TOC</a>
|
    <a href="support.html">support</a>
</p>


<h1>squirrel away files and notes</h1>

<ul>
<li><a href="#doc_git_squirrel_why_">why</a></li>
<li><a href="#doc_git_squirrel_cautions_">cautions</a></li>
<li><a href="#doc_git_squirrel_syntax_">syntax</a>
<ul>
<li><a href="#doc_git_squirrel_note_on_branch_and_filenames_">note on branch and filenames</a></li>
<li><a href="#doc_git_squirrel_view_the_current_repo_">view the current repo</a></li>
<li><a href="#doc_git_squirrel_list_branches_and_or_files_">list branches and/or files</a></li>
<li><a href="#doc_git_squirrel_edit_files_directly_and_save_back_">edit files directly and save back</a></li>
<li><a href="#doc_git_squirrel_save_files_">save files</a></li>
<li><a href="#doc_git_squirrel_restore_files_">restore files</a></li>
</ul></li>
</ul>

<p><a name="doc_git_squirrel_why_"></a></p>

<h2>why</h2>

<p>Here are my two most common uses for this:</p>

<ul>
<li><p>I have plenty of files that I probably don't need again, but don't dare to
delete <em>right now</em>.  Since cleaning up the hard disk is a chore, I never
get around to doing it <em>later</em> and they hang around pretty much forever.</p></li>
<li><p>A lot of artifacts at work are ODT/ODS/ODP, and I don't like using normal
git workflows with them due to merge issues.  Since the buck stops with me
on these docs, I simply choose to save them everyday using this mechanism.</p></li>
</ul>

<p>You can do most of the above with normal directories (except the part about
versioning LibreOffice files), but I think having the files directly on disk
is ugly and messy, not to mention too "in your face", for stuff you may never
need.</p>

<p><font color="gray">A word about email: if <em>all</em> your work items come via
email, it is certainly feasible to use the mail client itself to do all this.
My problem is there is so much <em>more</em> junk (junk != spam, please note) on
email, it slows down everything else.  There are dozens of attachments I don't
even open, for instance.  With squirrel, I am only dealing with content that I
at least had a passing interest in, and which has been on my hard disk, <em>other
than</em> just sitting in my email, at some point.</font></p>

<p>I want to</p>

<ul>
<li>reduce clutter on my file system</li>
<li>save arbitrary files in some categorised fashion</li>
<li>save multiple revisions of the same file at regular intervals</li>
<li>record accurately when they were saved (Unix timestamps are too fragile)</li>
<li>allow me to delete them en-masse if needed</li>
<li>get automatic de-dup for similar content</li>
<li>get "better-than-unison" syncing between computers</li>
</ul>

<p><code>git squirrel</code> is a tool to manage your own special "dump everything here" git
repository.</p>

<p><a name="doc_git_squirrel_cautions_"></a></p>

<h2>cautions</h2>

<ul>
<li><p>the repo should NOT be bare.  This <em>is</em> a work repo, except you're using
it via a special program.</p>

<p>For example, I have an equivalent repo on my other machines, and manual
syncs involve the usual push/pull between one central -- bare -- repo and
each of the work repos on different machines.</p>

<p>In other words, exactly the same as any other "working repo".</p></li>
<li><p>for the same reasons, do not run one squirrel command when another one is
pending.  They both use the same repo/working tree!</p></li>
<li><p>dont use it for files that are too large; this isn't anything
significantly different from other git repos.  This is not git-annexe or
bup :-)</p></li>
</ul>

<p><a name="doc_git_squirrel_syntax_"></a></p>

<h2>syntax</h2>

<p><strong>TIP</strong>: The <code>--repo</code> option is, umm, not an option.  I have this in my
<code>~/.gitconfig</code> so my commands are just <code>git z ...</code>:</p>

<pre><code>[alias]
    z   =   squirrel --repo=/home/sitaram/imli/repos/squirrel
</code></pre>

<p>That is what <strong>all</strong> the examples in this document will assume.</p>

<p>Don't forget you're supposed to have <em>one</em> squirrel repo for your whole
machine (otherwise you're back to square one searching for files!)</p>

<p><a name="doc_git_squirrel_note_on_branch_and_filenames_"></a></p>

<h3>note on branch and filenames</h3>

<ul>
<li><p>If a branch name begins with a <code>/</code>, the rest of that word is taken to be a
pattern to be regex-matched against all know branch names.</p>

<p>Where only one match is required or reasonable, the <strong>last</strong> match, in
sorted order, is picked; it is not an error that more matches exist.</p></li>
<li><p>The same logic holds for filenames, except that <em>all</em> the matching
filenames are picked, not just one.</p></li>
</ul>

<p><a name="doc_git_squirrel_view_the_current_repo_"></a></p>

<h3>view the current repo</h3>

<p>arguments: list of branch names or patterns</p>

<pre><code>git z -v                            # gitk, all branches
git z -v tig                        # tig, all branches
git z -v /foo bar                   # gitk, branches bar and any branch
                                    # containing 'foo' in the name
</code></pre>

<p>Squirrel adds a <code>--date-order</code> to the viewer's arguments for convenience.</p>

<p><a name="doc_git_squirrel_list_branches_and_or_files_"></a></p>

<h3>list branches and/or files</h3>

<p>arguments: one branch name or pattern, followed by optional list of file names
or patterns</p>

<pre><code>git z -l /foo                       # list all branches containing 'foo' in the name
git z -l /foo /gl                   # list all files containing 'gl' in the name from
                                    # within all branches containing 'foo' in the name
git z -l /foo /pdf /jpg             # list all jpgs and pdfs in all
                                    # branches containing 'foo' in the
                                    # name
git z -l 2011/misc mypic.jpg        # list a specific file in a specific branch
</code></pre>

<p><a name="doc_git_squirrel_edit_files_directly_and_save_back_"></a></p>

<h3>edit files directly and save back</h3>

<p>This works only for text files, and uses <code>$VISUAL</code>, then <code>$EDITOR</code>, falling
back to <code>vim</code> if none of these are set.</p>

<p>arguments: one branch name or pattern, followed by optional list of file
patterns (actual filenames not allowed here), followed by an optional list of
words to search <em>within</em> the files.  These words are processed as arguments to
'git grep' except we choose a default of --and, not --or.</p>

<p>The branch name will be created if it is not a pattern and does not already
exist.</p>

<p>This is an interesting command.  I suggest you don't use it until I figure out
where I'm going with it, but if you have to, give it a whirl :-)</p>

<p><a name="doc_git_squirrel_save_files_"></a></p>

<h3>save files</h3>

<p>arguments: one branch name/pattern, optional "commit message", list of
files/directories to save</p>

<p>The branch name will be created if it is not a pattern and does not already
exist.  The optional commit message must not have the same name as a file or a
directory in the original directory.</p>

<pre><code>git z -s bills/2012 *-payment.jpg   # save all the screenshot to bills/2012

git z -s /bills     *-payment.jpg   # same, assuming bills/2012 is the last
                                    # of the matching branches in sort order

git z -s reviews/2011 "first round of reviews" [...files...]
                                    # add a "commit message"; see tips
                                    # section later for why this may useful

git z -s reviews/2011 papers/*.pdf reviews/*.ods
                                    # run such a command regularly to save
                                    # w-i-p; only changes will go through,
                                    # just like normal git
</code></pre>

<p>Note: just like normal git, don't use this with huge binaries etc.; use
git-annex or something for those).</p>

<p><a name="doc_git_squirrel_restore_files_"></a></p>

<h3>restore files</h3>

<p>arguments: one branchname/pattern, followed by an optional list of file names
or patterns.</p>

<p>NOTE: restores to /tmp by default</p>

<pre><code>git z -r /reviews /access           # restore all files containing
                                    # 'access' in their names from the
                                    # last (in sorted order) branch whose
                                    # name contains 'reviews'

git z -r /reviews                   # same, but restore all the files in
                                    # the branch

git z -r=. /reviews                 # same, but restore to $PWD

git z -r --cm='first' /reviews      # see notes below
</code></pre>

<p>The commit match (--cm) option does a regex search on the output of <code>git log
--date-order --oneline</code> after checking out the given branch.  The first SHA
found is used.</p>
